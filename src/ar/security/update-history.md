# تحديث dv.net والتحقق منه

يعد تحديث `dv.net` أمرًا بسيطًا وآمنًا باستخدام مديري الحزم القياسيين في نظام التشغيل لديك، مثل `apt` أو `yum` أو `dnf`.

## التحقق التلقائي من التحديث

مع كل تحديث، يقوم مدير الحزم لديك بالتحقق تلقائيًا من أصالة الحزم. يتم ذلك باستخدام مفتاح GPG العمومي الخاص بنا، ممّا يضمن حصولك على برمجيات أصلية وغير معدّلة. لا تحتاج إلى إجراء أي خطوات يدوية للتحقق من التوقيع — فبرامج `apt` و`yum` و`dnf` تتكفّل بذلك نيابةً عنك.

مفتاحنا العمومي متاح على: <https://dv.net/gpg.pub>

------------------------------------------------------------------------

## عرض وفحص سجل التحديثات

يمكنك بسهولة مراجعة سجل جميع التحديثات المثبّتة والتأكد من سلامتها.

### لأنظمة Debian / Ubuntu (باستخدام `apt`)

يُحفظ سجل التحديثات في ملفات السجل. يمكنك عرضه بالأمر التالي:

``` bash
grep "upgrade dv.net" /var/log/dpkg.log
```

أو لعرض سجل `apt` بمزيد من التفصيل:

``` bash
grep "dv.net" /var/log/apt/history.log
```

تُبيّن هذه السجلات أي إصدارات من حزمة `dv.net` تم تثبيتها ومتى. وبما أنّ `apt` يتحقق من تواقيع GPG قبل التثبيت، فإن وجود سجل في الملف يؤكد نجاح التحديث.

### لأنظمة CentOS / RHEL (باستخدام `yum`)

`yum` يوفّر طريقة مريحة لعرض سجل المعاملات.

``` bash
yum history list dv.net
```

للحصول على معلومات تفصيلية حول تحديث معيّن من القائمة، استخدم:

``` bash
yum history info <transaction_ID>
```

يعرض هذا الأمر تفاصيل المعاملة، بما في ذلك معلومات التحقق من مفتاح GPG.

### لنظام Fedora والإصدارات الأحدث من CentOS / RHEL (باستخدام `dnf`)

`dnf` يستخدم الصياغة نفسها مثل `yum` لإدارة السجل.

``` bash
dnf history list dv.net
```

للحصول على معلومات تفصيلية حول تحديث محدد:

``` bash
dnf history info <transaction_ID>
```

وكما في `yum`، سيعرض `dnf` معلومات كاملة عن المعاملة، مؤكّدًا أن الحزمة اجتازت فحوصات الأصالة قبل التثبيت.

## التحقق من الحزم التي تم تنزيلها مباشرةً

حتى بعد تثبيت الحزمة، يمكنك التحقق من سلامتها وأصالتها. تُخزَّن جميع الحزم التي تم تنزيلها مؤقتًا في ذاكرة التخزين المؤقت لمدير الحزم، حيث يمكن التحقق منها يدويًا. يفيد ذلك في عمليات التدقيق الأمني أو للتأكد من أنّ ملفًا مُثبّتًا سابقًا لم يتعرّض للتلف.

## لأنظمة Debian / Ubuntu

افتراضيًا، يقوم `APT` بحذف ملفات `.deb` بعد اكتمال التثبيت بنجاح. لجعل `APT` يحتفظ دائمًا بالحزم التي تم تنزيلها في ذاكرته المؤقتة، أنشئ ملف إعدادات:

``` bash
echo 'APT::Keep-Downloaded-Packages "true";' | sudo tee /etc/apt/apt.conf.d/01keep-debs
```

سيتم تخزين جميع الحزم التي تم تنزيلها في `/var/cache/apt/archives/`.

### الطريقة 1: التحقق من توقيع GPG (موصى بها)

أوثق طريقة هي فحص توقيع GPG الخاص بالحزمة. يؤكد ذلك أن الحزمة صادرة عنّا ولم يتم تعديلها.

``` bash
# Install the utility if missing
sudo apt-get install dpkg-sig

# Verify the signature of a specific package
dpkg-sig --verify /var/cache/apt/archives/dv-updater_*.deb
```

إذا نجح الفحص، سترى حالة GOODSIG، ما يشير إلى الأصالة. ✅

### الطريقة 2: التحقق من المجموع الاختباري

يمكنك أيضًا التحقق من سلامة الملف بمقارنة مجموعه الاختباري مع ذلك المدرج في بيانات المستودع الوصفية.

1.  تحقّق من المجموع الاختباري الرسمي للحزمة باستخدام `apt-cache`:

    ``` bash
    apt-cache show dv-updater
    ```

    في المخرجات، ابحث عن السطر الذي يحتوي على SHA256:

        Package: dv-updater
        Version: 0.0.11~RC01-nightly-20250717T220501Z
        Architecture: amd64
        Maintainer: dv-updater
        Installed-Size: 14500
        Filename: pool/main/d/dv-updater/dv-updater_0.0.11~RC01-nightly-20250717T220501Z_amd64.deb
        Size: 6025526
        SHA256: 2c60a10e0a55fb22903497280f78ab66e463e10a11b250c3147eb5672cd929bb
        Description: no description given

2.  احسب المجموع الاختباري للملف الذي تم تنزيله:

    ``` bash
    sha256sum /var/cache/apt/archives/dv-updater_0.0.11~RC01-nightly-20250717T220501Z_amd64.deb
    ```

3.  قارن النتائج. يجب أن تُطابق قيمة التجزئة تمامًا تلك الظاهرة في ناتج `apt-cache show`.

------------------------------------------------------------------------

## لأنظمة CentOS / RHEL / Fedora

`dnf` و`yum` يحفظان الحزم التي تم تنزيلها في الذاكرة المؤقتة افتراضيًا. وعادةً ما تكون في مجلد فرعي داخل `/var/cache/dnf/`.

### الطريقة 1: التحقق من توقيع GPG (موصى بها)

استخدم أداة `rpm` القياسية للتحقق من توقيع ملف `.rpm` تم تنزيله. هذه هي الطريقة الأنسب والأوثق.

``` bash
# Locate the package in the cache and verify it
rpm --checksig /var/cache/dnf/dvnet-*/packages/*.rpm
```

*ملاحظة: قد يختلف المسار قليلًا حسب إصدار نظامك. تساعد العلامة `*` في تحديد الدليل الصحيح تلقائيًا.*

إذا كان التوقيع صالحًا، فسيتضمن خرج الأمر لكل حزمة تم فحصها `digests signatures OK`.

### الطريقة 2: التحقق من المجموع الاختباري

تفحص هذه الطريقة سلامة الملف، لكنها لا تتحقق من أصالته.

1.  احصل على المجموع الاختباري الرسمي للحزمة من المستودع:

    ``` bash
    dnf repoquery --info dv-processing
    ```

    أو لـ `yum`:

    ``` bash
    repoquery --info dv-processing
    ```

    في المخرجات، ابحث عن سطر Checksum:

        Name         : dv-processing
        Version      : 0.6.6
        ...
        Checksum Type: sha256
        Checksum     : f019a9564433cacf7a1c307e9a358e43cb9a3325abcdef1234567890abcdef
        ...

2.  احسب المجموع الاختباري للملف الموجود في الذاكرة المؤقتة:

    ``` bash
    sha256sum /var/cache/dnf/dvnet-*/packages/dv-processing_0.6.6_linux_amd64.rpm
    ```

3.  قارن القيمتين. يجب أن تكونا متطابقتين.